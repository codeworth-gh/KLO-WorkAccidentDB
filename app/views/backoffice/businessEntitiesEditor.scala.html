@import be.objectify.deadbolt.scala.AuthenticatedRequest
@(frm:Form[BusinessEntity])(implicit request:AuthenticatedRequest[_], msgs:MessagesProvider)

@extraHead={
  <script>
    const deleteMsg="@Messages("businessEntitiesEditor.deleteMsg")";
    const subMsg="@Messages("businessEntitiesEditor.deleteMsgSub")";
    function kickoffDeleteEntity(){
        Informationals.makeYesNo(deleteMsg, subMsg,
                (res, info)=>{info.dismiss(); if (res){ doDelete();}},
                null,
                Informationals.messageTypes.DANGER
                ).show();
    }

    function doDelete(){
        Informationals.loader("@Messages("deleting")");
        new Playjax(beRoutes).using(c=>c.BusinessEntityCtrl.doDeleteEntity(@frm("id").value.get))
                .fetch()
                .then( function(r){
                    if (r.ok) {
                      window.location.href=beRoutes.controllers.BusinessEntityCtrl.backofficeIndex().url;
                    } else {
                      Informationals.loader.dismiss();
                      Informationals.makeDanger("@Messages("businessEntitiesEditor.deletionFailed")");
                    }
                });
    }
  </script>
}

@templates.backEndBase(Messages("businessEntitiesEditor.title"), views.BackOfficeSections.BusinessEntities, extraHead) {
  @comps.pageTitleRow(Messages("businessEntitiesEditor.title")){
    @if( frm("id").value.getOrElse(0)!="0" ){
      <button type="button" onclick="kickoffDeleteEntity()" class="btn btn-danger">@comps.svgTrash() @Messages("delete")</button>
      <hr class="vr">
    }
    <button type="button" onclick="document.getElementById('bizEntityForm').submit()" class="btn btn-primary">@comps.svgCheck() @Messages("save")</button>
    <a class="btn btn-outline-danger" href="@routes.BusinessEntityCtrl.backofficeIndex(None)">@comps.svgX() @Messages("cancel")</a>
  }

  <div class="row my-2">
    <div class="col">
      <form action="@routes.BusinessEntityCtrl.doSaveEntity()" method="post" id="bizEntityForm">
        @helper.CSRF.formField
        @if( frm("id").value.getOrElse(0)!="0" ){
          <div class="row mb-3">
            <label for="fldId" class="col-sm-2 col-form-label">@Messages("id")</label>
            <div class="col-sm-10">
              <input id="fldId" type="text" class="form-control-plaintext" name="id" readonly value="@frm("id").value.get">
            </div>
          </div>
        }else{
          <input type="hidden" name="id" value="0">
        }
        <div class="row mb-3">
          <label for="fldName" class="col-sm-2 col-form-label">
            @Messages("name")
            <span class="badge bg-warning">@Messages("mandatoryField")</span>
          </label>
          <div class="col-sm-10">
            <input type="text" class="form-control" name="name" id="fldName" value="@frm("name").value">
          </div>
        </div>
        <div class="row mb-3">
          <div class="form-check">
            @defining( frm("isPrivatePerson").value.contains("true")){ isPrPsn =>
              <input type="checkbox" class="form-check-input" value="true" name="isPrivatePerson" id="fldPrivatePerson" @if(isPrPsn){checked="checked"}>
            }
            <label for="fldPrivatePerson" class="form-check-label">@Messages("businessEntities.isPrivatePerson")</label>
          </div>
        </div>
        <div class="row mb-3">
          <label for="fldPhone" class="col-sm-2 col-form-label">@Messages("phone")</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="fldPhone" name="phone" value="@frm("phone").value.getOrElse("")">
          </div>
        </div>
        <div class="row mb-3">
          <label for="fldEmail" class="col-sm-2 col-form-label">@Messages("email")</label>
          <div class="col-sm-10">
            <input type="email" class="form-control" name="email" id="fldEmail" value="@frm("email").value.getOrElse("")">
          </div>
        </div>
        <div class="row mb-3">
          <label for="fldWebsite" class="col-sm-2 col-form-label">@Messages("website")</label>
          <div class="col-sm-10">
            <input type="url" class="form-control" name="website" id="fldWebsite" value="@frm("website").value.getOrElse("")">
          </div>
        </div>
        <div class="row mb-3">
          <label for="fldMemo" class="col-sm-2 col-form-label">@Messages("memo")</label>
          <div class="col-sm-10">
            <textarea name="memo" rows="5" id="fldMemo" class="form-control">@frm("memo").value.getOrElse("")</textarea>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col text-end">
            <button type="submit" class="btn btn-primary">@comps.svgCheck() @Messages("save")</button>
            <a class="btn btn-outline-danger" href="@routes.BusinessEntityCtrl.backofficeIndex(None)">@comps.svgX() @Messages("cancel")</a>
          </div>
        </div>
      </form>
    </div>
  </div>
}